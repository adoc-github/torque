spec_version: 2
description: Testing ansible grain.
inputs:
  instance_ip:
    type: string
    default: 0.0.0.0
outputs: {}
grains:
  validate:
    kind: shell
    spec:
      agent:
        name: adoc-vcenter
      activities:
        deploy:
          commands:
            - "ls -la"

  install-apache:
    kind: ansible
    depends-on: validate
    spec:
      source:
        store: iac-assets
        path: ansible/install-apache.yml
      agent:
        name: adoc-vcenter
      inventory-file:
        all:
          hosts:
            '{{ .inputs.instance_ip }}':
          vars:
            ansible_user: centos
            ansible_ssh_private_key_file: /var/secrets/torque.pem
